<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>LoL Pro Draft Simulator v3.0</title>
    <style>
        :root { --blue: #00a3ff; --red: #e74c3c; --gold: #c8aa6e; --bg: #060e13; --card-bg: #121c23; }
        body { background: var(--bg); color: white; font-family: 'Malgun Gothic', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* í—¤ë” & ìŠ¹ë¥ ë°” */
        .header { background: #111; padding: 10px 40px; border-bottom: 2px solid #333; }
        .winrate-track { width: 100%; height: 30px; background: var(--red); display: none; position: relative; border-radius: 15px; overflow: hidden; margin-top: 10px; }
        #blue-win-bar { width: 50%; height: 100%; background: var(--blue); transition: 1s; }
        .wr-label { position: absolute; width: 100%; display: flex; justify-content: space-between; padding: 0 12px; line-height: 30px; pointer-events: none; font-weight: bold; box-sizing: border-box; }

        /* ë ˆì´ì•„ì›ƒ */
        .main { display: flex; flex: 1; padding: 15px; gap: 15px; overflow: hidden; }
        .side { width: 280px; display: flex; flex-direction: column; gap: 8px; }
        
        .ban-container { display: flex; gap: 4px; margin-bottom: 5px; }
        .ban-slot { width: 45px; height: 45px; background: #000; border: 1px solid #333; background-size: cover; filter: grayscale(1); }
        .ban-slot.active { border-color: var(--gold); box-shadow: 0 0 5px var(--gold); }

        .slot { height: 80px; background: var(--card-bg); border: 2px solid #222; display: flex; align-items: center; padding: 0 10px; position: relative; transition: 0.3s; }
        .slot.active { border-color: var(--gold); box-shadow: 0 0 10px var(--gold); }
        .pos-indicator { position: absolute; top: 5px; left: 10px; font-size: 10px; color: var(--gold); font-weight: bold; }
        .champ-img { width: 60px; height: 60px; background-size: cover; border: 1px solid #444; }
        .swap-btn { cursor: pointer; background: #333; border: none; color: white; padding: 3px 7px; font-size: 12px; margin-left: auto; display: none; border-radius: 3px; }

        /* ì¤‘ì•™ íŒ¨ë„ */
        .center { flex: 1; display: flex; flex-direction: column; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; border: 1px solid #222; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; overflow-y: auto; padding-top: 10px; }
        .card { cursor: pointer; text-align: center; font-size: 11px; transition: 0.2s; position: relative; }
        .card img { width: 100%; border: 2px solid #333; border-radius: 2px; }
        .card:hover img { border-color: var(--gold); transform: scale(1.05); }
        .card.disabled { opacity: 0.15; filter: grayscale(1); pointer-events: none; }
        .card.pos-mismatch { opacity: 0.3; filter: brightness(0.5); }

        .filter-group { margin-top: 8px; }
        .filter-label { font-size: 10px; color: #8fa3b2; margin-bottom: 4px; letter-spacing: 0.3px; }
        .pos-nav { display: flex; gap: 6px; margin-top: 4px; flex-wrap: wrap; }
        .pos-filter-btn { padding: 5px 8px; font-size: 11px; border: 1px solid #3a4952; background: #11191f; color: #cfd8dc; border-radius: 4px; cursor: pointer; }
        .pos-filter-btn.active { border-color: var(--gold); color: var(--gold); background: #202c34; }

        .tooltip { position: fixed; background: rgba(0,0,0,0.95); border: 1px solid var(--gold); padding: 8px; font-size: 12px; z-index: 1000; pointer-events: none; display: none; border-radius: 5px; line-height: 1.5; min-width: 220px; max-width: 320px; }
        .tip-stat { display: flex; align-items: center; gap: 6px; margin-top: 3px; }
        .tip-stat-label { width: 60px; color: #cfd8dc; }
        .tip-stat-track { display: inline-block; width: 96px; height: 8px; border-radius: 999px; background: #28343d; overflow: hidden; }
        .tip-stat-fill { display: block; height: 100%; border-radius: 999px; min-width: 0; }
        .tip-stat-value { width: 36px; text-align: right; color: #e0e0e0; }
        .team-summary { margin-top: 8px; background: linear-gradient(180deg, #121e27, #0c151c); border: 1px solid #2a3640; border-radius: 8px; padding: 10px; font-size: 11px; line-height: 1.45; color: #cfd8dc; box-shadow: inset 0 0 0 1px rgba(200,170,110,0.08); }
        .team-summary .title { font-weight: bold; margin-bottom: 6px; color: var(--gold); }
        .team-summary .row { display: flex; justify-content: space-between; gap: 8px; }
        .mini-bars { margin-top: 6px; display: flex; flex-direction: column; gap: 4px; }
        .mini-bar { display: flex; align-items: center; gap: 5px; }
        .mini-bar-label { width: 28px; color: #9fb3c2; font-size: 10px; }
        .mini-bar-track { flex: 1; height: 6px; background: #22303a; border-radius: 999px; overflow: hidden; }
        .mini-bar-fill { display: block; height: 100%; border-radius: 999px; }
        .mini-bar-value { width: 26px; text-align: right; font-size: 10px; color: #d4dde3; }
        .locked-wrap { margin-top: 8px; padding: 8px; border: 1px solid #2d3b45; border-radius: 6px; background: #101a21; }
        .locked-title { font-size: 10px; color: #9fb3c2; margin-bottom: 5px; }
        .locked-list { display: flex; flex-wrap: wrap; gap: 5px; max-height: 64px; overflow: auto; }
        .locked-chip { display: inline-flex; align-items: center; gap: 4px; padding: 3px 6px; border: 1px solid #4a2d34; background: #271a1d; color: #ffb5b5; border-radius: 999px; font-size: 10px; }
        .locked-chip img { width: 14px; height: 14px; border-radius: 50%; border: 1px solid #5d3b41; }
        .editor-wrap { margin-top: 10px; border: 1px solid #2f3d47; border-radius: 6px; background: #0f171d; }
        .editor-wrap summary { cursor: pointer; padding: 8px 10px; color: var(--gold); font-size: 12px; }
        .editor-body { padding: 8px 10px 10px; border-top: 1px solid #2f3d47; }
        #profile-editor { width: 100%; height: 130px; background: #090d10; color: #dde6ed; border: 1px solid #2d3b46; border-radius: 4px; font-family: monospace; font-size: 11px; padding: 8px; box-sizing: border-box; }
        .editor-btns { display: flex; gap: 6px; margin-top: 8px; }
        .editor-btn { padding: 6px 8px; background: #1c2a33; color: #dbe4ea; border: 1px solid #344550; border-radius: 4px; cursor: pointer; font-size: 11px; }
        .editor-msg { margin-top: 6px; color: #9fb3c2; font-size: 10px; min-height: 14px; }
        #tutorial-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.82); display: flex; align-items: center; justify-content: center; z-index: 3200; }
        .tutorial-card { width: min(820px, 92vw); max-height: 84vh; overflow: auto; background: linear-gradient(180deg,#16212a,#0d141a); border: 1px solid #364550; border-radius: 12px; padding: 18px; box-shadow: 0 12px 30px rgba(0,0,0,0.55); }
        .tutorial-title { margin: 0 0 8px; color: var(--gold); font-size: 20px; }
        .tutorial-list { margin: 0; padding-left: 18px; line-height: 1.6; color: #d6e0e8; font-size: 13px; }
        .tutorial-list li { margin-bottom: 6px; }
        .tutorial-btn { margin-top: 10px; padding: 9px 12px; border: 1px solid #445562; border-radius: 6px; background: #24333f; color: #e2ebf2; cursor: pointer; font-size: 12px; }
        #side-select-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 3100; }
        .side-select-card { width: min(520px, 92vw); background: linear-gradient(180deg,#18222b,#0d141a); border: 1px solid #3a4a57; border-radius: 12px; padding: 20px; text-align: center; }
        .side-title { margin: 0 0 8px; color: var(--gold); }
        .side-desc { margin: 0 0 12px; color: #c9d5de; font-size: 13px; }
        .side-btn-wrap { display: flex; gap: 10px; justify-content: center; }
        .side-btn { min-width: 140px; padding: 10px 14px; border: 1px solid #445562; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: bold; }
        .side-btn.blue { background: #163248; color: #9ad7ff; border-color: #245a80; }
        .side-btn.red { background: #451f24; color: #ffb2b2; border-color: #7c3944; }
        #result-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 2000; }

        @media (max-width: 900px) {
            body { height: auto; min-height: 100vh; overflow: auto; }
            .header { padding: 10px 12px; }
            .main { flex-direction: column; padding: 10px; gap: 10px; overflow: visible; }
            .center { order: 1; padding: 10px; }
            .side { width: 100%; order: 2; }
            #red-side { order: 3; }
            .slot { height: 72px; }
            .champ-img { width: 52px; height: 52px; }
            .grid { grid-template-columns: repeat(auto-fill, minmax(64px, 1fr)); gap: 8px; }
            .card { font-size: 10px; }
            .pos-nav { gap: 4px; }
            .pos-filter-btn { padding: 4px 7px; font-size: 10px; }
            #series-info { font-size: 11px; line-height: 1.4; }
            .tutorial-card { width: 94vw; max-height: 86vh; padding: 14px; }
        }
    </style>
</head>
<body>

<div class="header">
    <div style="display:flex; justify-content: space-between; font-weight: bold;">
        <span id="blue-info" style="color:var(--blue)">BLUE CC: 0 | ë”œ: 0 | íƒ±: 0</span>
        <span id="step-msg" style="color:var(--gold); font-size: 20px;">ë°´í”½ ì‹œì‘</span>
        <span id="red-info" style="color:var(--red)">RED CC: 0 | ë”œ: 0 | íƒ±: 0</span>
    </div>
    <div id="series-info" style="font-size:12px; color:#9fb3c2; margin-top:6px; text-align:center;">BO5 ì¤€ë¹„ì¤‘</div>
    <div class="winrate-track">
        <div id="blue-win-bar"></div>
        <div class="wr-label">
            <span id="b-wr-txt">50.0%</span>
            <span id="r-wr-txt">50.0%</span>
        </div>
    </div>
</div>

<div class="main">
    <div class="side" id="blue-side">
        <div class="ban-container" id="b-bans"></div>
        <div id="b-picks"></div>
        <div id="b-team-summary" class="team-summary"></div>
    </div>

    <div class="center">
        <div style="background: #1a2328; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
            <input type="text" id="search" placeholder="ì±”í”¼ì–¸ ê²€ìƒ‰..." oninput="renderPool()" style="width:100%; padding:10px; background:#000; color:white; border:1px solid var(--gold); border-radius: 4px;">
            <div class="locked-wrap">
                <div class="locked-title">í•˜ë“œ í”¼ì–´ë¦¬ìŠ¤ ì ê¸ˆ ì±”í”¼ì–¸</div>
                <div id="locked-list" class="locked-list"></div>
            </div>
            <div class="filter-group">
                <div class="filter-label">í¬ì§€ì…˜ í•„í„°</div>
                <div class="pos-nav" id="pos-nav">
                    <button type="button" class="pos-filter-btn active" data-pos="ALL">ALL</button>
                    <button type="button" class="pos-filter-btn" data-pos="TOP">TOP</button>
                    <button type="button" class="pos-filter-btn" data-pos="JNG">JNG</button>
                    <button type="button" class="pos-filter-btn" data-pos="MID">MID</button>
                    <button type="button" class="pos-filter-btn" data-pos="ADC">ADC</button>
                    <button type="button" class="pos-filter-btn" data-pos="SPT">SPT</button>
                </div>
            </div>
            <div class="filter-group">
                <div class="filter-label">ìœ í˜• í•„í„°</div>
                <div class="pos-nav" id="type-nav">
                    <button type="button" class="pos-filter-btn active" data-type="ALL">ALL</button>
                    <button type="button" class="pos-filter-btn" data-type="Dive">ëŒì§„</button>
                    <button type="button" class="pos-filter-btn" data-type="Poke">í¬í‚¹</button>
                    <button type="button" class="pos-filter-btn" data-type="Anti">ë°›ì•„ì¹˜ê¸°</button>
                </div>
            </div>
            <p id="pos-guide" style="font-size: 12px; color: var(--gold); margin: 8px 0 0 0;">ğŸ’¡ í”½ ë‹¨ê³„ì—ì„œëŠ” ì–´ë–¤ ì±”í”¼ì–¸ì´ë“  ììœ ë¡­ê²Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <details class="editor-wrap">
                <summary>ì±”í”¼ì–¸ ìŠ¤ì¼€ì¼ í¸ì§‘ ë„êµ¬</summary>
                <div class="editor-body">
                    <textarea id="profile-editor" placeholder='{"Akali":{"type":"Dive","scale":3,"pos":"MID"}}'></textarea>
                    <div class="editor-btns">
                        <button class="editor-btn" type="button" onclick="loadProfileEditor()">í˜„ì¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button class="editor-btn" type="button" onclick="applyProfileEditor()">ë¶™ì—¬ë„£ê¸° ì ìš©</button>
                    </div>
                    <div class="editor-msg" id="editor-msg"></div>
                </div>
            </details>
        </div>
        <div class="grid" id="champ-grid"></div>
    </div>

    <div class="side" id="red-side">
        <div class="ban-container" id="r-bans" style="flex-direction: row-reverse;"></div>
        <div id="r-picks"></div>
        <div id="r-team-summary" class="team-summary"></div>
    </div>
</div>

<div id="tooltip" class="tooltip"></div>
<div id="side-select-modal">
    <div class="side-select-card">
        <h2 class="side-title">í•˜ë“œ í”¼ì–´ë¦¬ìŠ¤ BO5</h2>
        <p class="side-desc">ì§„ì˜ì„ ì„ íƒí•˜ì„¸ìš”. ì„ íƒí•˜ì§€ ì•Šì€ íŒ€ì€ ì»´í“¨í„°ê°€ ìë™ í”½í•©ë‹ˆë‹¤.</p>
        <div class="side-btn-wrap">
            <button class="side-btn blue" type="button" onclick="chooseSide('blue')">ë¸”ë£¨íŒ€ ì„ íƒ</button>
            <button class="side-btn red" type="button" onclick="chooseSide('red')">ë ˆë“œíŒ€ ì„ íƒ</button>
        </div>
    </div>
</div>
<div id="tutorial-modal">
    <div class="tutorial-card">
        <h2 class="tutorial-title">ë°´í”½ ì‹œë®¬ë ˆì´í„° íŠœí† ë¦¬ì–¼</h2>
        <ol class="tutorial-list">
            <li>ì±”í”¼ì–¸ì€ <b>ë‹¨ì¼ ìœ í˜• + ìŠ¤ì¼€ì¼(1~3)</b>ë§Œ ê°€ì§‘ë‹ˆë‹¤. ì˜ˆ: `í¬í‚¹ 3`, `ë°›ì•„ì¹˜ê¸° 2`.</li>
            <li>ìœ í˜• ìƒì„±: <b>í¬í‚¹ > ë°›ì•„ì¹˜ê¸° > ëŒì§„ > í¬í‚¹</b>. ìƒì„± ìš°ìœ„ì¼ìˆ˜ë¡ ìŠ¹ë¥  ì°¨ì´ê°€ í¬ê²Œ ë²Œì–´ì§‘ë‹ˆë‹¤.</li>
            <li>ë”œë§/íƒ±í‚¹/CCëŠ” íŒ€ ê¸°ë³¸ ì „íˆ¬ë ¥ì— í•©ì‚°ë©ë‹ˆë‹¤. (ê° ì±”í”¼ì–¸ë³„ ìŠ¤íƒ¯ í•©)</li>
            <li>ìœ í˜• ìŠ¤ì¼€ì¼ì€ ì—­ë°¸ëŸ°ì‹±ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤: <b>ë”œ/íƒ±/CCê°€ ë†’ì„ìˆ˜ë¡ ìŠ¤ì¼€ì¼â†“, ë‚®ì„ìˆ˜ë¡ ìŠ¤ì¼€ì¼â†‘</b>.</li>
            <li>ìµœì¢… ìŠ¹ë¥ ì€ ì™„ë£Œ ì‹œì ì—ë§Œ í‘œì‹œë˜ë©°, ê¸°ë³¸ ì „íˆ¬ë ¥ + ìœ í˜• ìƒì„± ì ìˆ˜ë¥¼ í•¨ê»˜ ë°˜ì˜í•©ë‹ˆë‹¤.</li>
        </ol>
        <button class="tutorial-btn" type="button" onclick="closeTutorial()">ì´í•´í–ˆì–´ìš”, ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div id="result-modal">
    <div style="background:#1a2328; border:2px solid var(--gold); padding:40px; text-align:center; width:500px; border-radius: 15px;">
        <h1 id="winner-text" style="font-size: 48px; margin-top:0;">BLUE WIN</h1>
        <div id="final-stats" style="margin: 20px 0; line-height: 2;"></div>
        <button id="result-next-btn" onclick="handleNextAction()" style="padding:12px 30px; background:var(--gold); border:none; cursor:pointer; font-weight:bold; font-size: 16px;">ë‹¤ìŒ ì„¸íŠ¸</button>
    </div>
</div>

<script>
// 1. ëª¨ë“  ì±”í”¼ì–¸ ë°ì´í„° (167ëª…) ë° í¬ì§€ì…˜ ë§¤í•‘
const CHAMP_DB = {
    "Aatrox": { name: "ì•„íŠ¸ë¡ìŠ¤", type: "Dive", cc: 1, pos: ["TOP"] },
    "Ahri": { name: "ì•„ë¦¬", type: "Poke", cc: 1, pos: ["MID"] },
    "Akali": { name: "ì•„ì¹¼ë¦¬", type: "Dive", cc: 0, pos: ["MID", "TOP"] },
    "Akshan": { name: "ì•„í¬ìƒ¨", type: "Dive", cc: 0, pos: ["MID", "TOP"] },
    "Alistar": { name: "ì•Œë¦¬ìŠ¤íƒ€", type: "Anti", cc: 3, pos: ["SPT"] },
    "Ambessa": { name: "ì•”ë² ì‚¬", type: "Dive", cc: 2, pos: ["TOP", "JNG"] },
    "Amumu": { name: "ì•„ë¬´ë¬´", type: "Anti", cc: 3, pos: ["JNG", "SPT"] },
    "Anivia": { name: "ì• ë‹ˆë¹„ì•„", type: "Anti", cc: 2, pos: ["MID"] },
    "Annie": { name: "ì• ë‹ˆ", type: "Dive", cc: 2, pos: ["MID", "SPT"] },
    "Aphelios": { name: "ì•„í ë¦¬ì˜¤ìŠ¤", type: "Poke", cc: 0, pos: ["ADC"] },
    "Ashe": { name: "ì• ì‰¬", type: "Poke", cc: 2, pos: ["ADC", "SPT"] },
    "AurelionSol": { name: "ì•„ìš°ë ë¦¬ì˜¨ ì†”", type: "Poke", cc: 2, pos: ["MID"] },
    "Azir": { name: "ì•„ì§€ë¥´", type: "Poke", cc: 2, pos: ["MID"] },
    "Bard": { name: "ë°”ë“œ", type: "Anti", cc: 2, pos: ["SPT"] },
    "Belveth": { name: "ë²¨ë² ìŠ¤", type: "Dive", cc: 1, pos: ["JNG"] },
    "Blitzcrank": { name: "ë¸”ë¦¬ì¸ í¬ë­í¬", type: "Dive", cc: 3, pos: ["SPT"] },
    "Brand": { name: "ë¸Œëœë“œ", type: "Poke", cc: 1, pos: ["JNG", "SPT", "MID"] },
    "Braum": { name: "ë¸Œë¼ì›€", type: "Anti", cc: 3, pos: ["SPT"] },
    "Briar": { name: "ë¸Œë¼ì´ì–´", type: "Dive", cc: 2, pos: ["JNG"] },
    "Caitlyn": { name: "ì¼€ì´í‹€ë¦°", type: "Poke", cc: 1, pos: ["ADC"] },
    "Camille": { name: "ì¹´ë°€", type: "Dive", cc: 2, pos: ["TOP", "SPT"] },
    "Cassiopeia": { name: "ì¹´ì‹œì˜¤í˜ì•„", type: "Anti", cc: 1, pos: ["MID", "TOP"] },
    "Chogath": { name: "ì´ˆê°€ìŠ¤", type: "Anti", cc: 2, pos: ["TOP", "MID"] },
    "Corki": { name: "ì½”ë¥´í‚¤", type: "Poke", cc: 0, pos: ["MID", "ADC"] },
    "Darius": { name: "ë‹¤ë¦¬ìš°ìŠ¤", type: "Dive", cc: 1, pos: ["TOP"] },
    "Diana": { name: "ë‹¤ì´ì•„ë‚˜", type: "Dive", cc: 1, pos: ["JNG", "MID"] },
    "Draven": { name: "ë“œë ˆì´ë¸", type: "Dive", cc: 1, pos: ["ADC"] },
    "DrMundo": { name: "ë¬¸ë„ ë°•ì‚¬", type: "Dive", cc: 0, pos: ["TOP"] },
    "Ekko": { name: "ì—ì½”", type: "Dive", cc: 2, pos: ["JNG", "MID"] },
    "Elise": { name: "ì—˜ë¦¬ìŠ¤", type: "Dive", cc: 2, pos: ["JNG"] },
    "Evelynn": { name: "ì´ë¸Œë¦°", type: "Dive", cc: 1, pos: ["JNG"] },
    "Ezreal": { name: "ì´ì¦ˆë¦¬ì–¼", type: "Poke", cc: 0, pos: ["ADC"] },
    "Fiddlesticks": { name: "í”¼ë“¤ìŠ¤í‹±", type: "Dive", cc: 3, pos: ["JNG"] },
    "Fiora": { name: "í”¼ì˜¤ë¼", type: "Dive", cc: 1, pos: ["TOP"] },
    "Fizz": { name: "í”¼ì¦ˆ", type: "Dive", cc: 1, pos: ["MID"] },
    "Galio": { name: "ê°ˆë¦¬ì˜¤", type: "Anti", cc: 3, pos: ["MID", "SPT"] },
    "Gangplank": { name: "ê°±í”Œë­í¬", type: "Poke", cc: 1, pos: ["TOP", "MID"] },
    "Garen": { name: "ê°€ë Œ", type: "Dive", cc: 1, pos: ["TOP"] },
    "Gnar": { name: "ë‚˜ë¥´", type: "Dive", cc: 2, pos: ["TOP"] },
    "Gragas": { name: "ê·¸ë¼ê°€ìŠ¤", type: "Anti", cc: 3, pos: ["JNG", "TOP", "MID"] },
    "Graves": { name: "ê·¸ë ˆì´ë¸Œì¦ˆ", type: "Dive", cc: 0, pos: ["JNG"] },
    "Gwen": { name: "ê·¸ì›¬", type: "Dive", cc: 0, pos: ["TOP", "JNG"] },
    "Hecarim": { name: "í—¤ì¹´ë¦¼", type: "Dive", cc: 1, pos: ["JNG"] },
    "Heimerdinger": { name: "í•˜ì´ë¨¸ë”©ê±°", type: "Anti", cc: 1, pos: ["SPT", "MID", "TOP"] },
    "Hwei": { name: "íì›¨ì´", type: "Poke", cc: 2, pos: ["MID", "SPT"] },
    "Illaoi": { name: "ì¼ë¼ì˜¤ì´", type: "Anti", cc: 0, pos: ["TOP"] },
    "Irelia": { name: "ì´ë ë¦¬ì•„", type: "Dive", cc: 1, pos: ["TOP", "MID"] },
    "Ivern": { name: "ì•„ì´ë²ˆ", type: "Anti", cc: 2, pos: ["JNG"] },
    "Janna": { name: "ì”ë‚˜", type: "Anti", cc: 3, pos: ["SPT"] },
    "JarvanIV": { name: "ìë¥´ë°˜ 4ì„¸", type: "Dive", cc: 2, pos: ["JNG"] },
    "Jax": { name: "ì­ìŠ¤", type: "Dive", cc: 1, pos: ["TOP", "JNG"] },
    "Jayce": { name: "ì œì´ìŠ¤", type: "Poke", cc: 1, pos: ["TOP", "MID"] },
    "Jhin": { name: "ì§„", type: "Poke", cc: 2, pos: ["ADC"] },
    "Jinx": { name: "ì§•í¬ìŠ¤", type: "Poke", cc: 1, pos: ["ADC"] },
    "Kaisa": { name: "ì¹´ì´ì‚¬", type: "Dive", cc: 0, pos: ["ADC"] },
    "Kalista": { name: "ì¹¼ë¦¬ìŠ¤íƒ€", type: "Dive", cc: 1, pos: ["ADC"] },
    "Karma": { name: "ì¹´ë¥´ë§ˆ", type: "Poke", cc: 1, pos: ["SPT", "MID"] },
    "Karthus": { name: "ì¹´ì„œìŠ¤", type: "Poke", cc: 0, pos: ["JNG"] },
    "Kassadin": { name: "ì¹´ì‚¬ë”˜", type: "Dive", cc: 1, pos: ["MID"] },
    "Katarina": { name: "ì¹´íƒ€ë¦¬ë‚˜", type: "Dive", cc: 0, pos: ["MID"] },
    "Kayle": { name: "ì¼€ì¼", type: "Anti", cc: 0, pos: ["TOP", "MID"] },
    "Kayn": { name: "ì¼€ì¸", type: "Dive", cc: 1, pos: ["JNG"] },
    "Kennen": { name: "ì¼€ë„¨", type: "Dive", cc: 2, pos: ["TOP"] },
    "Khazix": { name: "ì¹´ì§ìŠ¤", type: "Dive", cc: 0, pos: ["JNG"] },
    "Kindred": { name: "í‚¨ë“œë ˆë“œ", type: "Anti", cc: 0, pos: ["JNG"] },
    "Kled": { name: "í´ë ˆë“œ", type: "Dive", cc: 1, pos: ["TOP"] },
    "KogMaw": { name: "ì½”ê·¸ëª¨", type: "Poke", cc: 0, pos: ["ADC", "MID"] },
    "Ksante": { name: "í¬ì‚°í…Œ", type: "Anti", cc: 3, pos: ["TOP"] },
    "Leblanc": { name: "ë¥´ë¸”ë‘", type: "Poke", cc: 2, pos: ["MID"] },
    "LeeSin": { name: "ë¦¬ì‹ ", type: "Dive", cc: 2, pos: ["JNG"] },
    "Leona": { name: "ë ˆì˜¤ë‚˜", type: "Dive", cc: 3, pos: ["SPT"] },
    "Lillia": { name: "ë¦´ë¦¬ì•„", type: "Dive", cc: 2, pos: ["JNG"] },
    "Lissandra": { name: "ë¦¬ì‚°ë“œë¼", type: "Anti", cc: 3, pos: ["MID"] },
    "Lucian": { name: "ë£¨ì‹œì•ˆ", type: "Dive", cc: 0, pos: ["ADC", "MID"] },
    "Lulu": { name: "ë£°ë£¨", type: "Anti", cc: 2, pos: ["SPT"] },
    "Lux": { name: "ëŸ­ìŠ¤", type: "Poke", cc: 2, pos: ["SPT", "MID"] },
    "Malphite": { name: "ë§íŒŒì´íŠ¸", type: "Dive", cc: 3, pos: ["TOP", "MID", "SPT"] },
    "Malzahar": { name: "ë§ìí•˜", type: "Anti", cc: 3, pos: ["MID"] },
    "Maokai": { name: "ë§ˆì˜¤ì¹´ì´", type: "Anti", cc: 3, pos: ["JNG", "SPT", "TOP"] },
    "MasterYi": { name: "ë§ˆìŠ¤í„°ì´", type: "Dive", cc: 0, pos: ["JNG"] },
    "Milio": { name: "ë°€ë¦¬ì˜¤", type: "Anti", cc: 1, pos: ["SPT"] },
    "MissFortune": { name: "ë¯¸ìŠ¤í¬ì¸ˆ", type: "Poke", cc: 1, pos: ["ADC"] },
    "MonkeyKing": { name: "ì˜¤ê³µ", type: "Dive", cc: 2, pos: ["JNG", "TOP"] },
    "Mordekaiser": { name: "ëª¨ë°ì¹´ì´ì €", type: "Anti", cc: 1, pos: ["TOP", "JNG"] },
    "Morgana": { name: "ëª¨ë¥´ê°€ë‚˜", type: "Anti", cc: 3, pos: ["SPT", "JNG"] },
    "Naafiri": { name: "ë‚˜í”¼ë¦¬", type: "Dive", cc: 0, pos: ["MID"] },
    "Nami": { name: "ë‚˜ë¯¸", type: "Anti", cc: 2, pos: ["SPT"] },
    "Nasus": { name: "ë‚˜ì„œìŠ¤", type: "Anti", cc: 1, pos: ["TOP"] },
    "Nautilus": { name: "ë…¸í‹¸ëŸ¬ìŠ¤", type: "Dive", cc: 3, pos: ["SPT"] },
    "Neeko": { name: "ë‹ˆì½”", type: "Dive", cc: 2, pos: ["MID", "SPT"] },
    "Nidalee": { name: "ë‹ˆë‹¬ë¦¬", type: "Poke", cc: 0, pos: ["JNG"] },
    "Nilah": { name: "ë‹ë¼", type: "Dive", cc: 2, pos: ["ADC"] },
    "Nocturne": { name: "ë…¹í„´", type: "Dive", cc: 2, pos: ["JNG"] },
    "Nunu": { name: "ëˆ„ëˆ„", type: "Dive", cc: 2, pos: ["JNG"] },
    "Olaf": { name: "ì˜¬ë¼í”„", type: "Dive", cc: 0, pos: ["TOP", "JNG"] },
    "Orianna": { name: "ì˜¤ë¦¬ì•„ë‚˜", type: "Anti", cc: 2, pos: ["MID"] },
    "Ornn": { name: "ì˜¤ë¥¸", type: "Anti", cc: 3, pos: ["TOP"] },
    "Pantheon": { name: "íŒí…Œì˜¨", type: "Dive", cc: 2, pos: ["MID", "TOP", "JNG", "SPT"] },
    "Poppy": { name: "ë½€ì‚", type: "Anti", cc: 2, pos: ["JNG", "TOP", "SPT"] },
    "Pyke": { name: "íŒŒì´í¬", type: "Dive", cc: 2, pos: ["SPT"] },
    "Qiyana": { name: "í‚¤ì•„ë‚˜", type: "Dive", cc: 2, pos: ["MID", "JNG"] },
    "Quinn": { name: "í€¸", type: "Poke", cc: 1, pos: ["TOP"] },
    "Rakan": { name: "ë¼ì¹¸", type: "Dive", cc: 3, pos: ["SPT"] },
    "Rammus": { name: "ëŒë¨¸ìŠ¤", type: "Anti", cc: 2, pos: ["JNG"] },
    "RekSai": { name: "ë ‰ì‚¬ì´", type: "Dive", cc: 2, pos: ["JNG"] },
    "Rell": { name: "ë ", type: "Dive", cc: 3, pos: ["SPT", "JNG"] },
    "Renata": { name: "ë ˆë‚˜íƒ€", type: "Anti", cc: 2, pos: ["SPT"] },
    "Renekton": { name: "ë ˆë„¥í†¤", type: "Dive", cc: 1, pos: ["TOP"] },
    "Rengar": { name: "ë ê°€", type: "Dive", cc: 1, pos: ["JNG", "TOP"] },
    "Riven": { name: "ë¦¬ë¸", type: "Dive", cc: 2, pos: ["TOP"] },
    "Rumble": { name: "ëŸ¼ë¸”", type: "Poke", cc: 1, pos: ["TOP", "MID", "JNG"] },
    "Ryze": { name: "ë¼ì´ì¦ˆ", type: "Poke", cc: 1, pos: ["MID", "TOP"] },
    "Samira": { name: "ì‚¬ë¯¸ë¼", type: "Dive", cc: 1, pos: ["ADC"] },
    "Sejuani": { name: "ì„¸ì£¼ì•„ë‹ˆ", type: "Anti", cc: 3, pos: ["JNG"] },
    "Senna": { name: "ì„¸ë‚˜", type: "Poke", cc: 1, pos: ["SPT", "ADC"] },
    "Seraphine": { name: "ì„¸ë¼í•€", type: "Poke", cc: 2, pos: ["SPT", "MID", "ADC"] },
    "Sett": { name: "ì„¸íŠ¸", type: "Dive", cc: 2, pos: ["TOP", "MID", "SPT"] },
    "Shaco": { name: "ìƒ¤ì½”", type: "Dive", cc: 1, pos: ["JNG", "SPT"] },
    "Shen": { name: "ì‰”", type: "Anti", cc: 2, pos: ["TOP", "SPT"] },
    "Shyvana": { name: "ì‰¬ë°”ë‚˜", type: "Dive", cc: 0, pos: ["JNG"] },
    "Singed": { name: "ì‹ ì§€ë“œ", type: "Anti", cc: 2, pos: ["TOP"] },
    "Sion": { name: "ì‚¬ì´ì˜¨", type: "Anti", cc: 2, pos: ["TOP"] },
    "Sivir": { name: "ì‹œë¹„ë¥´", type: "Poke", cc: 0, pos: ["ADC"] },
    "Skarner": { name: "ìŠ¤ì¹´ë„ˆ", type: "Dive", cc: 3, pos: ["JNG", "TOP"] },
    "Smolder": { name: "ìŠ¤ëª°ë”", type: "Poke", cc: 0, pos: ["ADC", "MID"] },
    "Sona": { name: "ì†Œë‚˜", type: "Poke", cc: 2, pos: ["SPT"] },
    "Soraka": { name: "ì†Œë¼ì¹´", type: "Anti", cc: 1, pos: ["SPT"] },
    "Swain": { name: "ìŠ¤ì›¨ì¸", type: "Anti", cc: 1, pos: ["MID", "SPT", "TOP"] },
    "Sylas": { name: "ì‚¬ì¼ëŸ¬ìŠ¤", type: "Dive", cc: 1, pos: ["MID", "JNG", "TOP"] },
    "Syndra": { name: "ì‹ ë“œë¼", type: "Poke", cc: 2, pos: ["MID"] },
    "TahmKench": { name: "íƒì¼„ì¹˜", type: "Anti", cc: 2, pos: ["SPT", "TOP"] },
    "Taliyah": { name: "íƒˆë¦¬ì•¼", type: "Anti", cc: 2, pos: ["MID", "JNG"] },
    "Talon": { name: "íƒˆë¡ ", type: "Dive", cc: 0, pos: ["JNG", "MID"] },
    "Taric": { name: "íƒ€ë¦­", type: "Anti", cc: 2, pos: ["SPT"] },
    "Teemo": { name: "í‹°ëª¨", type: "Poke", cc: 0, pos: ["TOP", "SPT"] },
    "Thresh": { name: "ì“°ë ˆì‰¬", type: "Anti", cc: 3, pos: ["SPT"] },
    "Tristana": { name: "íŠ¸ë¦¬ìŠ¤íƒ€ë‚˜", type: "Dive", cc: 1, pos: ["ADC", "MID"] },
    "Trundle": { name: "íŠ¸ëŸ°ë“¤", type: "Anti", cc: 1, pos: ["TOP", "JNG"] },
    "Tryndamere": { name: "íŠ¸ë¦°ë‹¤ë¯¸ì–´", type: "Dive", cc: 0, pos: ["TOP"] },
    "TwistedFate": { name: "íŠ¸ìœ„ìŠ¤í‹°ë“œí˜ì´íŠ¸", type: "Poke", cc: 2, pos: ["MID", "ADC", "TOP"] },
    "Twitch": { name: "íŠ¸ìœ„ì¹˜", type: "Dive", cc: 0, pos: ["ADC", "JNG"] },
    "Udyr": { name: "ìš°ë””ë¥´", type: "Anti", cc: 1, pos: ["TOP", "JNG"] },
    "Urgot": { name: "ìš°ë¥´ê³³", type: "Anti", cc: 1, pos: ["TOP"] },
    "Varus": { name: "ë°”ë£¨ìŠ¤", type: "Poke", cc: 1, pos: ["ADC", "MID"] },
    "Vayne": { name: "ë² ì¸", type: "Dive", cc: 1, pos: ["ADC", "TOP"] },
    "Veigar": { name: "ë² ì´ê°€", type: "Poke", cc: 2, pos: ["MID", "SPT"] },
    "Velkoz": { name: "ë²¨ì½”ì¦ˆ", type: "Poke", cc: 1, pos: ["MID", "SPT"] },
    "Vex": { name: "ë²¡ìŠ¤", type: "Anti", cc: 2, pos: ["MID"] },
    "Vi": { name: "ë°”ì´", type: "Dive", cc: 3, pos: ["JNG"] },
    "Viego": { name: "ë¹„ì—ê³ ", type: "Dive", cc: 1, pos: ["JNG"] },
    "Viktor": { name: "ë¹…í† ë¥´", type: "Poke", cc: 1, pos: ["MID"] },
    "Vladimir": { name: "ë¸”ë¼ë””ë¯¸ë¥´", type: "Anti", cc: 0, pos: ["MID", "TOP"] },
    "Volibear": { name: "ë³¼ë¦¬ë² ì–´", type: "Dive", cc: 2, pos: ["JNG", "TOP"] },
    "Warwick": { name: "ì›Œìœ…", type: "Dive", cc: 2, pos: ["JNG", "TOP"] },
    "Xayah": { name: "ìì•¼", type: "Anti", cc: 1, pos: ["ADC"] },
    "Xerath": { name: "ì œë¼ìŠ¤", type: "Poke", cc: 1, pos: ["MID", "SPT"] },
    "XinZhao": { name: "ì‹ ì§œì˜¤", type: "Dive", cc: 2, pos: ["JNG"] },
    "Yasuo": { name: "ì•¼ìŠ¤ì˜¤", type: "Dive", cc: 1, pos: ["MID", "TOP", "ADC"] },
    "Yone": { name: "ìš”ë„¤", type: "Dive", cc: 1, pos: ["MID", "TOP"] },
    "Yorick": { name: "ìš”ë¦­", type: "Anti", cc: 0, pos: ["TOP"] },
    "Yuumi": { name: "ìœ ë¯¸", type: "Anti", cc: 1, pos: ["SPT"] },
    "Zac": { name: "ìí¬", type: "Dive", cc: 3, pos: ["JNG", "TOP"] },
    "Zed": { name: "ì œë“œ", type: "Dive", cc: 0, pos: ["MID", "JNG"] },
    "Zeri": { name: "ì œë¦¬", type: "Dive", cc: 0, pos: ["ADC"] },
    "Ziggs": { name: "ì§ìŠ¤", type: "Poke", cc: 1, pos: ["ADC", "MID"] },
    "Zilean": { name: "ì§ˆë¦¬ì–¸", type: "Anti", cc: 1, pos: ["SPT", "MID"] },
    "Zoe": { name: "ì¡°ì´", type: "Poke", cc: 1, pos: ["MID"] },
    "Zyra": { name: "ìì´ë¼", type: "Anti", cc: 2, pos: ["SPT", "JNG", "MID"] }
};
const CDN_VERSION = "14.24.1";
const CHAMP_IMG_KEY_MAP = {
    Ksante: "KSante"
};
const TYPE_LABEL = {
    Dive: "ëŒì§„",
    Poke: "í¬í‚¹",
    Anti: "ë°›ì•„ì¹˜ê¸°"
};

const clampStat = (value) => Math.min(Math.max(value, 1), 10);
const clampScale = (value) => Math.min(Math.max(Math.round(value), 1), 3);
const TYPE_BASE_STATS = {
    Dive: { dmg: 7, tank: 5 },
    Poke: { dmg: 8, tank: 3 },
    Anti: { dmg: 5, tank: 7 }
};
const CHAMP_STAT_OVERRIDES = {
    Akshan: { dmg: 9, tank: 2 },
    DrMundo: { dmg: 5, tank: 9 },
    Malphite: { dmg: 6, tank: 9 },
    Ornn: { dmg: 5, tank: 10 },
    Ksante: { dmg: 6, tank: 10 },
    Karthus: { dmg: 9, tank: 2 },
    Vayne: { dmg: 9, tank: 2 },
    Zeri: { dmg: 9, tank: 2 },
    Leona: { dmg: 4, tank: 9 },
    Nautilus: { dmg: 5, tank: 9 }
};
const CHAMP_PROFILE_OVERRIDES = {
    Brand: { type: "Anti", scale: 2, pos: "SPT" },
    Xerath: { type: "Poke", scale: 3, pos: "MID" },
    Poppy: { type: "Anti", scale: 3, pos: "TOP" },
    Akali: { type: "Dive", scale: 3, pos: "MID" },
    Garen: { type: "Dive", scale: 1, pos: "TOP" },
    Ambessa: { type: "Dive", scale: 3, pos: "TOP" },
    Ksante: { type: "Anti", scale: 3, pos: "TOP" }
};
const CHAMP_POSITION_OVERRIDES = {};
const CHAMP_DAMAGE_TYPE_OVERRIDES = {
    Akali: "AP",
    Diana: "AP",
    Ekko: "AP",
    Elise: "AP",
    Fizz: "AP",
    Katarina: "AP",
    Lillia: "AP",
    Evelynn: "AP",
    Nidalee: "AP",
    Karthus: "AP",
    Gragas: "AP",
    Sylas: "AP",
    Tristana: "AD",
    Corki: "Hybrid",
    KaiSa: "Hybrid",
    Kaisa: "Hybrid",
    Varus: "Hybrid",
    Twitch: "AD",
    Teemo: "AP",
    Yone: "AD",
    Yasuo: "AD",
    Jax: "Hybrid",
    Gwen: "AP",
    Volibear: "Hybrid",
    Udyr: "Hybrid",
    Zac: "AP",
    ChoGath: "AP",
    Chogath: "AP",
    Malphite: "AP",
    Rumble: "AP",
    Swain: "AP",
    Veigar: "AP",
    Viktor: "AP",
    Xerath: "AP",
    Ziggs: "AP",
    Zoe: "AP",
    Zyra: "AP"
};

Object.keys(CHAMP_DB).forEach((key) => {
    const champ = CHAMP_DB[key];
    const base = TYPE_BASE_STATS[champ.type] || { dmg: 6, tank: 6 };
    const ccBonus = champ.cc >= 2 ? 1 : 0;

    champ.dmg = clampStat(base.dmg + (champ.cc === 0 ? 1 : 0) + (champ.type === "Poke" ? 1 : 0) - (champ.type === "Anti" ? 1 : 0));
    champ.tank = clampStat(base.tank + ccBonus - (champ.type === "Poke" ? 1 : 0));

    if (CHAMP_STAT_OVERRIDES[key]) {
        champ.dmg = CHAMP_STAT_OVERRIDES[key].dmg;
        champ.tank = CHAMP_STAT_OVERRIDES[key].tank;
    }

    // ì±”í”¼ì–¸ë‹¹ í¬ì§€ì…˜ 1ê°œë¡œ ê°•ì œ ê³ ì •
    champ.pos = [CHAMP_POSITION_OVERRIDES[key] || champ.pos[0]];

    let profileType = champ.type;
    // ì—­ë°¸ëŸ°ì‹±: ê°•í•œ ê¸°ë³¸ ìŠ¤íƒ¯ì¼ìˆ˜ë¡ ìœ í˜• ìŠ¤ì¼€ì¼ì„ ë‚®ê²Œ ë¶€ì—¬
    const powerScore = champ.dmg + champ.tank + champ.cc * 2;
    let profileScale = 3;
    if (powerScore >= 19) profileScale = 1;
    else if (powerScore >= 14) profileScale = 2;
    if (CHAMP_PROFILE_OVERRIDES[key]) {
        profileType = CHAMP_PROFILE_OVERRIDES[key].type;
        profileScale = CHAMP_PROFILE_OVERRIDES[key].scale;
        if (CHAMP_PROFILE_OVERRIDES[key].pos) {
            champ.pos = [CHAMP_PROFILE_OVERRIDES[key].pos];
        }
    }
    champ.profile = { type: profileType, scale: clampScale(profileScale) };

    // AD / AP / í•˜ì´ë¸Œë¦¬ë“œ ë¶„ë¥˜
    let dmgType = champ.type === "Dive" ? "AD" : "AP";
    if (champ.pos[0] === "ADC") dmgType = "AD";
    if (CHAMP_DAMAGE_TYPE_OVERRIDES[key]) dmgType = CHAMP_DAMAGE_TYPE_OVERRIDES[key];
    champ.dmgType = dmgType;
});

const POSITIONS = ["TOP", "JNG", "MID", "ADC", "SPT"];
// ê³µì‹ ë°´í”½ ìˆœì„œ: 3ë°´-3í”½-2ë°´-2í”½ (ì „ìˆ ì  ìŠ¤ì™‘ ê³ ë ¤í•˜ì§€ ì•Šì€ ì •ì„ í¬ì§€ì…˜ ë§¤í•‘ ë²„ì „)
const DRAFT_ORDER = [
    {t:'blue', type:'ban', id:0}, {t:'red', type:'ban', id:0}, {t:'blue', type:'ban', id:1}, {t:'red', type:'ban', id:1}, {t:'blue', type:'ban', id:2}, {t:'red', type:'ban', id:2},
    {t:'blue', type:'pick', id:0}, {t:'red', type:'pick', id:0}, {t:'red', type:'pick', id:1}, {t:'blue', type:'pick', id:1}, {t:'blue', type:'pick', id:2}, {t:'red', type:'pick', id:2},
    {t:'red', type:'ban', id:3}, {t:'blue', type:'ban', id:3}, {t:'red', type:'ban', id:4}, {t:'blue', type:'ban', id:4},
    {t:'red', type:'pick', id:3}, {t:'blue', type:'pick', id:3}, {t:'blue', type:'pick', id:4}, {t:'red', type:'pick', id:4}
];

let currentStep = 0;
let picks = { blue: [null,null,null,null,null], red: [null,null,null,null,null] };
let bans = { blue: [null,null,null,null,null], red: [null,null,null,null,null] };
let swapSource = null;
let activePosFilter = "ALL";
let activeTypeFilter = "ALL";
let userTeam = null;
let aiTeam = null;
let currentGame = 1;
let seriesWins = { blue: 0, red: 0 };
let fearlessLocked = new Set();
let aiThinking = false;
let lastSeriesEnded = false;
const MAX_GAMES = 5;
const WIN_TARGET = 3;

function getChampionImageUrl(key) {
    const imageKey = CHAMP_IMG_KEY_MAP[key] || key;
    return `https://ddragon.leagueoflegends.com/cdn/${CDN_VERSION}/img/champion/${imageKey}.png`;
}

function renderStatRow(label, icon, value, maxValue, color) {
    const percentage = Math.min((value / maxValue) * 100, 100);
    const width = value > 0 ? Math.max(percentage, 8) : 0;
    return `
        <div class="tip-stat">
            <span class="tip-stat-label">${icon} ${label}</span>
            <span class="tip-stat-track"><span class="tip-stat-fill" style="width:${width}%; background:${color};"></span></span>
            <span class="tip-stat-value">${value}/${maxValue}</span>
        </div>
    `;
}

function canAssignDistinctPositions(championKeys) {
    const used = {};
    const tryAssign = (idx, visited) => {
        if (visited[idx]) return false;
        visited[idx] = true;
        const key = championKeys[idx];
        const poss = CHAMP_DB[key].pos;
        for (const p of poss) {
            if (!used[p]) {
                used[p] = key;
                return true;
            }
        }
        for (const p of poss) {
            const prevKey = used[p];
            if (!prevKey) continue;
            used[p] = key;
            const prevIdx = championKeys.indexOf(prevKey);
            if (prevIdx >= 0 && tryAssign(prevIdx, visited)) return true;
            used[p] = prevKey;
        }
        return false;
    };

    for (let i = 0; i < championKeys.length; i++) {
        const ok = tryAssign(i, {});
        if (!ok) return false;
    }
    return true;
}

function canPickForTeam(team, key) {
    const selected = picks[team].filter(Boolean);
    return canAssignDistinctPositions([...selected, key]);
}

function updateSeriesInfo() {
    const sideTxt = userTeam ? `MY TEAM: ${userTeam.toUpperCase()} / AI TEAM: ${aiTeam.toUpperCase()}` : "MY TEAM: ì„ íƒ ì „";
    document.getElementById('series-info').innerText = `HARD FEARLESS BO5 | SET ${currentGame}/${MAX_GAMES} | SCORE B ${seriesWins.blue} : ${seriesWins.red} R | ${sideTxt} | ëˆ„ì  ì ê¸ˆ ${fearlessLocked.size}`;
}

function getTeamRoleLabel(team) {
    if (!userTeam) return team.toUpperCase();
    return team === userTeam ? "MY TEAM" : "AI TEAM";
}

function renderLockedChamps() {
    const list = document.getElementById('locked-list');
    if (!list) return;
    const locked = [...fearlessLocked];
    if (locked.length === 0) {
        list.innerHTML = `<span style="font-size:10px;color:#7f95a3;">ì•„ì§ ì ê¸ˆ ì—†ìŒ</span>`;
        return;
    }
    list.innerHTML = locked.map((key) => `<span class="locked-chip"><img src="${getChampionImageUrl(key)}" alt="${CHAMP_DB[key]?.name || key}"><span>${CHAMP_DB[key]?.name || key}</span></span>`).join("");
}

function clearBoardUI() {
    for (let i = 0; i < 5; i++) {
        const bBan = document.getElementById(`b-ban-${i}`);
        const rBan = document.getElementById(`r-ban-${i}`);
        const bSlot = document.getElementById(`b-slot-${i}`);
        const rSlot = document.getElementById(`r-slot-${i}`);
        if (bBan) bBan.style.backgroundImage = "";
        if (rBan) rBan.style.backgroundImage = "";
        if (bSlot) {
            bSlot.querySelector('.champ-img').style.backgroundImage = "";
            bSlot.querySelector('.name').innerText = "-";
            bSlot.style.borderColor = "#222";
        }
        if (rSlot) {
            rSlot.querySelector('.champ-img').style.backgroundImage = "";
            rSlot.querySelector('.name').innerText = "-";
            rSlot.style.borderColor = "#222";
        }
    }
    document.querySelectorAll('.swap-btn').forEach((b) => b.style.display = 'none');
}

function startGameDraft() {
    currentStep = 0;
    picks = { blue: [null, null, null, null, null], red: [null, null, null, null, null] };
    bans = { blue: [null, null, null, null, null], red: [null, null, null, null, null] };
    swapSource = null;
    aiThinking = false;
    clearBoardUI();
    document.getElementById('result-modal').style.display = 'none';
    updateSeriesInfo();
    renderLockedChamps();
    renderPool();
    updateUI();
    calculateStats();
}

function resetSeries() {
    currentGame = 1;
    seriesWins = { blue: 0, red: 0 };
    fearlessLocked = new Set();
    lastSeriesEnded = false;
    startGameDraft();
}

function chooseSide(side) {
    userTeam = side;
    aiTeam = side === "blue" ? "red" : "blue";
    document.getElementById('side-select-modal').style.display = 'none';
    resetSeries();
}

function init() {
    const bBans = document.getElementById('b-bans');
    const rBans = document.getElementById('r-bans');
    const bPicks = document.getElementById('b-picks');
    const rPicks = document.getElementById('r-picks');

    POSITIONS.forEach((pos, i) => {
        bBans.innerHTML += `<div class="ban-slot" id="b-ban-${i}"></div>`;
        rBans.innerHTML += `<div class="ban-slot" id="r-ban-${i}"></div>`;
        bPicks.innerHTML += `<div class="slot" id="b-slot-${i}"><span class="pos-indicator">${pos}</span><div class="champ-img"></div><div style="margin-left:10px;"><div class="name">-</div></div><button class="swap-btn" onclick="handleSwap('blue', ${i})">ğŸ”ƒ</button></div>`;
        rPicks.innerHTML += `<div class="slot" id="r-slot-${i}" style="flex-direction:row-reverse; text-align:right;"><span class="pos-indicator" style="right:10px; left:auto;">${pos}</span><div class="champ-img"></div><div style="margin-right:10px;"><div class="name">-</div></div><button class="swap-btn" onclick="handleSwap('red', ${i})">ğŸ”ƒ</button></div>`;
    });
    document.querySelectorAll('.pos-filter-btn').forEach((btn) => {
        if (btn.dataset.pos) {
            btn.addEventListener('click', () => {
                activePosFilter = btn.dataset.pos;
                document.querySelectorAll('#pos-nav .pos-filter-btn').forEach((b) => b.classList.toggle('active', b === btn));
                renderPool();
            });
        }
        if (btn.dataset.type) {
            btn.addEventListener('click', () => {
                activeTypeFilter = btn.dataset.type;
                document.querySelectorAll('#type-nav .pos-filter-btn').forEach((b) => b.classList.toggle('active', b === btn));
                renderPool();
            });
        }
    });
    renderPool();
    updateUI();
    calculateStats();
}

function renderPool() {
    const grid = document.getElementById('champ-grid');
    const term = document.getElementById('search').value.toLowerCase();
    grid.innerHTML = '';
    const step = currentStep < DRAFT_ORDER.length ? DRAFT_ORDER[currentStep] : null;
    const pickingTeam = step && step.type === 'pick' ? step.t : null;

    Object.keys(CHAMP_DB).forEach(key => {
        const c = CHAMP_DB[key];
        const isSelected = [...picks.blue, ...picks.red, ...bans.blue, ...bans.red].includes(key);
        const isFearlessLocked = fearlessLocked.has(key);
        const matchesSearch = c.name.includes(term) || key.toLowerCase().includes(term) || TYPE_LABEL[c.profile.type].includes(term) || c.profile.type.toLowerCase().includes(term);
        const matchesPosFilter = activePosFilter === "ALL" || c.pos.includes(activePosFilter);
        const matchesTypeFilter = activeTypeFilter === "ALL" || c.profile.type === activeTypeFilter;
        const isPickValid = !pickingTeam || canPickForTeam(pickingTeam, key);

        if (matchesSearch && matchesPosFilter && matchesTypeFilter) {
            const div = document.createElement('div');
            div.className = `card ${isSelected || isFearlessLocked ? 'disabled' : ''} ${!isPickValid ? 'pos-mismatch' : ''}`;
            div.innerHTML = `
                <img src="${getChampionImageUrl(key)}" onerror="this.onerror=null;this.src='https://placehold.co/120x120/121c23/c8aa6e?text=${encodeURIComponent(c.name)}';">
                <p>${c.name}</p>
            `;
            
            div.onmouseover = (e) => showTooltip(e, `
                <b>${c.name}</b><br>ìœ í˜•: ${TYPE_LABEL[c.profile.type]} ${c.profile.scale}<br>
                <div style="margin-top:4px; color:#ffe082;">í”¼í•´ íƒ€ì…: ${c.dmgType}</div>
                ${renderStatRow("ë”œë§", "âš”", c.dmg, 10, "#ef5350")}
                ${renderStatRow("íƒ±í‚¹", "ğŸ›¡", c.tank, 10, "#42a5f5")}
                ${renderStatRow("CC", "ğŸŒ€", c.cc, 3, "#ffca28")}
                ${renderStatRow(TYPE_LABEL[c.profile.type], "â—†", c.profile.scale, 3, "#ab47bc")}
                <div style="margin-top:5px; color:#cfd8dc;">ì£¼ í¬ì§€ì…˜: ${c.pos.join(', ')}</div>${isFearlessLocked ? '<div style="margin-top:5px;color:#ef9a9a;">í”¼ì–´ë¦¬ìŠ¤ ì ê¸ˆë¨ (ì´ì „ ì„¸íŠ¸ í”½)</div>' : ''}
            `);
            div.onmousemove = (e) => moveTooltip(e);
            div.onmouseout = hideTooltip;
            
            if (!isSelected && !isFearlessLocked && isPickValid) {
                div.onclick = () => selectChamp(key);
            }
            grid.appendChild(div);
        }
    });
}

function selectChamp(key, byAI = false) {
    if (!userTeam) return;
    if (currentStep >= DRAFT_ORDER.length) return;
    const step = DRAFT_ORDER[currentStep];
    if (!byAI && step.t === aiTeam) return;
    
    if (step.type === 'ban') {
        bans[step.t][step.id] = key;
        document.getElementById(`${step.t[0]}-ban-${step.id}`).style.backgroundImage = `url(${getChampionImageUrl(key)})`;
    } else {
        picks[step.t][step.id] = key;
        refreshUI(step.t);
    }

    currentStep++;
    document.getElementById('search').value = '';
    renderPool();
    updateUI();
    calculateStats();
}

function updateUI() {
    document.querySelectorAll('.slot, .ban-slot').forEach(s => s.classList.remove('active'));
    updateSeriesInfo();
    const wrTrack = document.querySelector('.winrate-track');
    if (currentStep < DRAFT_ORDER.length) {
        wrTrack.style.display = "none";
        const step = DRAFT_ORDER[currentStep];
        const elId = step.type === 'ban' ? `${step.t[0]}-ban-${step.id}` : `${step.t[0]}-slot-${step.id}`;
        document.getElementById(elId).classList.add('active');
        
        const nextTeam = step.t.toUpperCase();
        const isAiTurn = userTeam && step.t === aiTeam;
        document.getElementById('step-msg').innerText = isAiTurn ? `AI(${nextTeam}) ${step.type.toUpperCase()}...` : `${nextTeam} ${step.type.toUpperCase()}...`;
        document.getElementById('pos-guide').innerText = step.type === 'pick' ? "ğŸ’¡ í¬ì§€ì…˜ ìˆœì„œ ì œí•œ ì—†ì´ í”½ ê°€ëŠ¥í•˜ì§€ë§Œ, íŒ€ ë‚´ í¬ì§€ì…˜ ì¤‘ë³µì´ ë°œìƒí•˜ëŠ” ì¡°í•©ì€ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." : "ğŸ’¡ ìƒëŒ€ì˜ í•µì‹¬ ì±”í”¼ì–¸ì„ ë°´í•˜ì„¸ìš”.";
        if (isAiTurn && !aiThinking) {
            aiThinking = true;
            setTimeout(aiTakeTurn, 550);
        }
    } else {
        wrTrack.style.display = "flex";
        document.getElementById('step-msg').innerText = `SET ${currentGame} ì¢…ë£Œ`;
        document.querySelectorAll('.swap-btn').forEach(b => b.style.display = 'block');
        showFinalResult();
    }
}

function getCompLabel(stats) {
    const dominant = getDominantProfile(stats);
    if (dominant.type === "Dive") return "ëŒì§„ ì¡°í•©";
    if (dominant.type === "Poke") return "í¬í‚¹ ì¡°í•©";
    return "ë°›ì•„ì¹˜ê¸° ì¡°í•©";
}

function getDominantProfile(stats) {
    const items = [
        { type: "Dive", value: stats.dive },
        { type: "Poke", value: stats.poke },
        { type: "Anti", value: stats.anti }
    ];
    // ë™ì  ì‹œì—ëŠ” ë¨¼ì € ë‚˜ì˜¨ ìœ í˜•ì„ íƒí•´ ë‹¨ì¼ ì¡°í•©ìœ¼ë¡œ ê³ ì • ë°˜ì˜
    let best = items[0];
    for (let i = 1; i < items.length; i++) {
        if (items[i].value > best.value) best = items[i];
    }
    return best;
}

function updateTeamPanels(b, r) {
    const maxProfileSum = 15;
    const makeBars = (teamStats, colorMap) => `
        <div class="mini-bars">
            <div class="mini-bar"><span class="mini-bar-label">ëŒì§„</span><span class="mini-bar-track"><span class="mini-bar-fill" style="width:${(teamStats.dive / maxProfileSum) * 100}%;background:${colorMap.dive};"></span></span><span class="mini-bar-value">${teamStats.dive}</span></div>
            <div class="mini-bar"><span class="mini-bar-label">í¬í‚¹</span><span class="mini-bar-track"><span class="mini-bar-fill" style="width:${(teamStats.poke / maxProfileSum) * 100}%;background:${colorMap.poke};"></span></span><span class="mini-bar-value">${teamStats.poke}</span></div>
            <div class="mini-bar"><span class="mini-bar-label">ë°›ì•„</span><span class="mini-bar-track"><span class="mini-bar-fill" style="width:${(teamStats.anti / maxProfileSum) * 100}%;background:${colorMap.anti};"></span></span><span class="mini-bar-value">${teamStats.anti}</span></div>
        </div>
    `;
    const blueSummary = document.getElementById('b-team-summary');
    const redSummary = document.getElementById('r-team-summary');
    const blueRole = getTeamRoleLabel('blue');
    const redRole = getTeamRoleLabel('red');
    blueSummary.innerHTML = `
        <div class="title">ë¸”ë£¨íŒ€ ìš”ì•½ (${blueRole})</div>
        <div class="row"><span>ê¸°ë³¸</span><span>CC ${b.cc} | ë”œ ${b.dmg} | íƒ± ${b.tank}</span></div>
        <div class="row"><span>AD/AP</span><span>AD ${Math.round(b.adRatio * 100)}% / AP ${Math.round((1 - b.adRatio) * 100)}%</span></div>
        <div class="row"><span>ì„±í–¥</span><span>ëŒì§„ ${b.dive} / í¬í‚¹ ${b.poke} / ë°›ì•„ì¹˜ê¸° ${b.anti}</span></div>
        <div class="row"><span>ì¡°í•©</span><span>${getCompLabel(b)}</span></div>
        ${makeBars(b, { dive: "#29b6f6", poke: "#66bb6a", anti: "#ab47bc" })}
    `;
    redSummary.innerHTML = `
        <div class="title">ë ˆë“œíŒ€ ìš”ì•½ (${redRole})</div>
        <div class="row"><span>ê¸°ë³¸</span><span>CC ${r.cc} | ë”œ ${r.dmg} | íƒ± ${r.tank}</span></div>
        <div class="row"><span>AD/AP</span><span>AD ${Math.round(r.adRatio * 100)}% / AP ${Math.round((1 - r.adRatio) * 100)}%</span></div>
        <div class="row"><span>ì„±í–¥</span><span>ëŒì§„ ${r.dive} / í¬í‚¹ ${r.poke} / ë°›ì•„ì¹˜ê¸° ${r.anti}</span></div>
        <div class="row"><span>ì¡°í•©</span><span>${getCompLabel(r)}</span></div>
        ${makeBars(r, { dive: "#ef5350", poke: "#ffa726", anti: "#7e57c2" })}
    `;
}

function getTeamStats(team, picksState) {
    let res = {
        cc: 0, dmg: 0, tank: 0, dive: 0, poke: 0, anti: 0,
        adCount: 0, apCount: 0, hybridCount: 0,
        adDmg: 0, apDmg: 0, adPressure: 0, apPressure: 0, adRatio: 0.5
    };
    picksState[team].forEach((key) => {
        if (key) {
            const c = CHAMP_DB[key];
            res.cc += c.cc;
            res.dmg += c.dmg;
            res.tank += c.tank;
            if (c.profile.type === "Dive") res.dive += c.profile.scale;
            if (c.profile.type === "Poke") res.poke += c.profile.scale;
            if (c.profile.type === "Anti") res.anti += c.profile.scale;
            if (c.dmgType === "AD") {
                res.adCount += 1;
                res.adDmg += c.dmg;
            } else if (c.dmgType === "AP") {
                res.apCount += 1;
                res.apDmg += c.dmg;
            } else {
                // í•˜ì´ë¸Œë¦¬ë“œëŠ” AD/AP ì˜í–¥ë„ë¥¼ ë°˜ë°˜ìœ¼ë¡œ ë¶„ë°°
                res.hybridCount += 1;
                res.adCount += 0.5;
                res.apCount += 0.5;
                res.adDmg += c.dmg * 0.5;
                res.apDmg += c.dmg * 0.5;
            }
        }
    });
    res.adPressure = res.adCount * res.adDmg;
    res.apPressure = res.apCount * res.apDmg;
    const totalPressure = res.adPressure + res.apPressure;
    res.adRatio = totalPressure > 0 ? (res.adPressure / totalPressure) : 0.5;
    return res;
}

function getCorePenalty(stats) {
    let penalty = 0;
    if (stats.dmg < 20) penalty -= 16 + (20 - stats.dmg) * 1.3;
    if (stats.tank < 20) penalty -= 16 + (20 - stats.tank) * 1.2;
    if (stats.cc <= 5) penalty -= 14 + (5 - stats.cc) * 2.0;
    return penalty;
}

function getDamageBalanceBonus(stats) {
    const total = stats.adPressure + stats.apPressure;
    if (total <= 0) return 0;
    const adShare = stats.adPressure / total;
    const dominantShare = Math.max(adShare, 1 - adShare);
    const symmetry = 1 - Math.abs(0.5 - adShare) * 2; // 0~1
    let bonus = symmetry * 4.5;
    if (dominantShare >= 0.8) {
        // AD/AP í•œìª½ì´ 80% ì´ìƒì´ë©´ í° í˜ë„í‹°
        bonus -= 16 + (dominantShare - 0.8) * 35;
    }
    return bonus;
}

function getWinRateByStats(b, r) {
    let statEdge = (b.cc - r.cc) * 0.9 + (b.dmg - r.dmg) * 0.8 + (b.tank - r.tank) * 0.8;
    const bMain = getDominantProfile(b);
    const rMain = getDominantProfile(r);
    const beats = { Poke: "Anti", Anti: "Dive", Dive: "Poke" };
    let matchupEdge = 0;
    if (bMain.type === rMain.type) {
        // ê°™ì€ ì¡°í•©ì´ë©´ ì¡°í•© ì ìˆ˜ ìš°ìœ„ë§Œ ì•½í•˜ê²Œ ë°˜ì˜
        matchupEdge = (bMain.value - rMain.value) * 0.9;
    } else {
        const bVal = Math.max(bMain.value, 1);
        const rVal = Math.max(rMain.value, 1);
        if (beats[bMain.type] === rMain.type) {
            // ìš°ìƒì„±: ë‚´ ì£¼ìœ í˜•ì´ ë†’ì„ìˆ˜ë¡ ë” ê°•í•˜ê²Œ ëˆ„ë¦„
            matchupEdge = Math.pow(bVal, 1.35) * Math.pow(rVal, 0.95);
        } else {
            // ì—­ìƒì„±: ë‚´ ì£¼ìœ í˜•ì´ ë†’ì„ìˆ˜ë¡ ì¹´ìš´í„° ë‹¹í•  ë•Œ í˜ë„í‹°ë„ ë” í¼
            matchupEdge = -Math.pow(rVal, 1.35) * Math.pow(bVal, 1.15);
        }
    }

    const bCorePenalty = getCorePenalty(b);
    const rCorePenalty = getCorePenalty(r);
    const bBalanceBonus = getDamageBalanceBonus(b);
    const rBalanceBonus = getDamageBalanceBonus(r);

    // ë”œ/íƒ± 20 ì´ìƒ íŒ€ì´ ë§ì„ìˆ˜ë¡ ì¡°í•© ìƒì„± ì˜í–¥ë„ë¥¼ ë” í‚¤ì›€
    const bStable = b.dmg > 20 && b.tank > 20;
    const rStable = r.dmg > 20 && r.tank > 20;
    const stableCount = (bStable ? 1 : 0) + (rStable ? 1 : 0);
    if (stableCount === 2) statEdge *= 0.55;
    else if (stableCount === 1) statEdge *= 0.75;
    const compMultiplier = stableCount === 2 ? 0.9 : (stableCount === 1 ? 0.78 : 0.65);

    const rawScore =
        statEdge +
        matchupEdge * compMultiplier +
        (bCorePenalty - rCorePenalty) +
        (bBalanceBonus - rBalanceBonus);

    let bWin = 50 + Math.tanh(rawScore / 20) * 46;
    bWin = Math.min(Math.max(bWin, 3), 97);
    return bWin;
}

function calculateStats() {
    const b = getTeamStats('blue', picks);
    const r = getTeamStats('red', picks);
    const blueRole = getTeamRoleLabel('blue');
    const redRole = getTeamRoleLabel('red');
    document.getElementById('blue-info').innerText = `${blueRole} (BLUE) CC: ${b.cc} | ë”œ: ${b.dmg} | íƒ±: ${b.tank}`;
    document.getElementById('red-info').innerText = `${redRole} (RED) CC: ${r.cc} | ë”œ: ${r.dmg} | íƒ±: ${r.tank}`;
    updateTeamPanels(b, r);

    const bWin = getWinRateByStats(b, r);
    if (currentStep >= DRAFT_ORDER.length) {
        document.getElementById('blue-win-bar').style.width = bWin + "%";
        document.getElementById('b-wr-txt').innerText = bWin.toFixed(1) + "%";
        document.getElementById('r-wr-txt').innerText = (100-bWin).toFixed(1) + "%";
    }

    return { bWin, b, r };
}

function aiTakeTurn() {
    if (!userTeam || currentStep >= DRAFT_ORDER.length) return;
    const step = DRAFT_ORDER[currentStep];
    if (step.t !== aiTeam) return;

    const taken = new Set([...picks.blue, ...picks.red, ...bans.blue, ...bans.red, ...fearlessLocked]);
    let candidates = Object.keys(CHAMP_DB).filter((key) => !taken.has(key));
    if (step.type === 'pick') {
        candidates = candidates.filter((key) => canPickForTeam(aiTeam, key));
    }
    if (candidates.length === 0) {
        if (step.type === 'pick') candidates = Object.keys(CHAMP_DB).filter((key) => !taken.has(key));
        else {
            aiThinking = false;
            return;
        }
    }
    if (candidates.length === 0) {
        aiThinking = false;
        return;
    }

    let bestKey = candidates[0];
    let bestScore = -Infinity;
    const enemyTeam = aiTeam === 'blue' ? 'red' : 'blue';
    candidates.forEach((key) => {
        let score = 0;
        const champ = CHAMP_DB[key];
        if (step.type === 'pick') {
            const saved = picks[aiTeam][step.id];
            picks[aiTeam][step.id] = key;
            const b = getTeamStats('blue', picks);
            const r = getTeamStats('red', picks);
            const bWin = getWinRateByStats(b, r);
            const perspective = aiTeam === 'blue' ? bWin : (100 - bWin);
            const bonus = champ.profile.scale * 1.2 + champ.cc * 0.4;
            score = perspective + bonus;
            picks[aiTeam][step.id] = saved;
        } else {
            // ë°´ì€ "ìƒëŒ€ê°€ ê°€ì ¸ê°”ì„ ë•Œ ë‚´ ìŠ¹ë¥ ì´ ê°€ì¥ ë–¨ì–´ì§€ëŠ” ì±”í”¼ì–¸"ì„ ìš°ì„  ì œê±°
            let simulatedThreat = 0;
            if (canPickForTeam(enemyTeam, key)) {
                const slotIdx = picks[enemyTeam].findIndex((v) => !v);
                if (slotIdx >= 0) {
                    const saved = picks[enemyTeam][slotIdx];
                    picks[enemyTeam][slotIdx] = key;
                    const b = getTeamStats('blue', picks);
                    const r = getTeamStats('red', picks);
                    const bWin = getWinRateByStats(b, r);
                    const aiPerspective = aiTeam === 'blue' ? bWin : (100 - bWin);
                    simulatedThreat = 100 - aiPerspective;
                    picks[enemyTeam][slotIdx] = saved;
                }
            }
            const rawPower = champ.dmg * 0.75 + champ.tank * 0.55 + champ.cc * 1.2 + champ.profile.scale * 1.1;
            score = simulatedThreat + rawPower * 0.45;
        }
        if (score > bestScore) {
            bestScore = score;
            bestKey = key;
        }
    });

    aiThinking = false;
    selectChamp(bestKey, true);
}

function handleSwap(team, idx) {
    if (swapSource === null) {
        swapSource = { team, idx };
        document.getElementById(`${team[0]}-slot-${idx}`).style.borderColor = "var(--gold)";
    } else {
        if (swapSource.team === team) {
            const temp = picks[team][swapSource.idx];
            picks[team][swapSource.idx] = picks[team][idx];
            picks[team][idx] = temp;
            refreshUI(team);
        }
        document.getElementById(`${swapSource.team[0]}-slot-${swapSource.idx}`).style.borderColor = "#222";
        swapSource = null;
    }
}

function refreshUI(team) {
    // ìŠ¬ë¡¯ í‘œì‹œ ê¸°ì¤€ì€ í”½ ìˆœì„œê°€ ì•„ë‹ˆë¼ ì±”í”¼ì–¸ì˜ ì‹¤ì œ í¬ì§€ì…˜
    POSITIONS.forEach((_, i) => {
        const slot = document.getElementById(`${team[0]}-slot-${i}`);
        slot.querySelector('.champ-img').style.backgroundImage = "";
        slot.querySelector('.name').innerText = "-";
    });

    picks[team].forEach((key) => {
        if (!key) return;
        const pos = CHAMP_DB[key].pos[0];
        const slotIdx = POSITIONS.indexOf(pos);
        if (slotIdx < 0) return;
        const slot = document.getElementById(`${team[0]}-slot-${slotIdx}`);
        slot.querySelector('.champ-img').style.backgroundImage = `url(${getChampionImageUrl(key)})`;
        slot.querySelector('.name').innerText = CHAMP_DB[key].name;
    });
}

function showFinalResult() {
    const res = calculateStats();
    const modal = document.getElementById('result-modal');
    modal.style.display = 'flex';
    const winner = res.bWin >= 50 ? "blue" : "red";
    const loser = winner === "blue" ? "red" : "blue";
    seriesWins[winner] += 1;
    [...picks.blue, ...picks.red].forEach((key) => { if (key) fearlessLocked.add(key); });
    updateSeriesInfo();
    renderLockedChamps();

    document.getElementById('winner-text').innerText = winner.toUpperCase() + " SET WIN";
    document.getElementById('winner-text').style.color = winner === "blue" ? "var(--blue)" : "var(--red)";
    
    const bComp = getCompLabel(res.b);
    const rComp = getCompLabel(res.r);
    const seriesEnded = seriesWins[winner] >= WIN_TARGET || currentGame >= MAX_GAMES;
    lastSeriesEnded = seriesEnded;
    const nextBtn = document.getElementById('result-next-btn');
    nextBtn.innerText = seriesEnded ? "ìƒˆ ì‹œë¦¬ì¦ˆ ì‹œì‘" : "ë‹¤ìŒ ì„¸íŠ¸ ì‹œì‘";

    document.getElementById('final-stats').innerHTML = `
        <p style="color:var(--gold);font-weight:bold;">ì„¸íŠ¸ ìŠ¤ì½”ì–´: BLUE ${seriesWins.blue} : ${seriesWins.red} RED</p>
        <p>ğŸ”µ ë¸”ë£¨íŒ€: ${bComp} (CC ${res.b.cc} / ë”œ ${res.b.dmg} / íƒ± ${res.b.tank})</p>
        <p style="font-size:13px; color:#cfd8dc;">ì„±í–¥í•©: ëŒì§„ ${res.b.dive} / í¬í‚¹ ${res.b.poke} / ë°›ì•„ì¹˜ê¸° ${res.b.anti}</p>
        <p>ğŸ”´ ë ˆë“œíŒ€: ${rComp} (CC ${res.r.cc} / ë”œ ${res.r.dmg} / íƒ± ${res.r.tank})</p>
        <p style="font-size:13px; color:#cfd8dc;">ì„±í–¥í•©: ëŒì§„ ${res.r.dive} / í¬í‚¹ ${res.r.poke} / ë°›ì•„ì¹˜ê¸° ${res.r.anti}</p>
        <hr style="border-color:#333">
        <h2 style="color:var(--gold)">ìŠ¹ë¦¬ í™•ë¥  ì˜ˆì¸¡: ${winner === "blue" ? res.bWin.toFixed(1) : (100-res.bWin).toFixed(1)}%</h2>
        <p style="font-size:12px;color:${seriesEnded ? '#ffd180' : '#9fb3c2'};">${seriesEnded ? `ì‹œë¦¬ì¦ˆ ì¢…ë£Œ: ${winner.toUpperCase()} ìŠ¹ë¦¬ (${seriesWins[winner]}-${seriesWins[loser]})` : `ë‹¤ìŒ SET ${currentGame + 1}ì—ì„œ í•˜ë“œ í”¼ì–´ë¦¬ìŠ¤ ì ê¸ˆì´ ìœ ì§€ë©ë‹ˆë‹¤.`}</p>
    `;
}

function handleNextAction() {
    document.getElementById('result-modal').style.display = 'none';
    if (lastSeriesEnded) {
        userTeam = null;
        aiTeam = null;
        document.getElementById('side-select-modal').style.display = 'flex';
        return;
    }
    // BO5 ë‚´ì—ì„œëŠ” ì„¸íŠ¸ë§ˆë‹¤ ì§„ì˜ ìë™ êµëŒ€
    userTeam = userTeam === "blue" ? "red" : "blue";
    aiTeam = userTeam === "blue" ? "red" : "blue";
    currentGame += 1;
    startGameDraft();
}

function showTooltip(e, txt) {
    const tip = document.getElementById('tooltip');
    tip.innerHTML = txt;
    tip.style.display = 'block';
    moveTooltip(e);
}
function moveTooltip(e) {
    const tip = document.getElementById('tooltip');
    if (tip.style.display !== 'block') return;
    const pad = 14;
    const tipRect = tip.getBoundingClientRect();
    let left = e.clientX + pad;
    let top = e.clientY + pad;
    if (left + tipRect.width > window.innerWidth - pad) left = e.clientX - tipRect.width - pad;
    if (top + tipRect.height > window.innerHeight - pad) top = e.clientY - tipRect.height - pad;
    if (left < pad) left = pad;
    if (top < pad) top = pad;
    tip.style.left = `${left}px`;
    tip.style.top = `${top}px`;
}
function hideTooltip() { document.getElementById('tooltip').style.display = 'none'; }

function normalizeTypeKey(rawType) {
    if (rawType === "Dive" || rawType === "Poke" || rawType === "Anti") return rawType;
    if (rawType === "ëŒì§„") return "Dive";
    if (rawType === "í¬í‚¹") return "Poke";
    if (rawType === "ë°›ì•„ì¹˜ê¸°") return "Anti";
    return null;
}
function closeTutorial() {
    document.getElementById('tutorial-modal').style.display = 'none';
}

function loadProfileEditor() {
    const editor = document.getElementById('profile-editor');
    editor.value = JSON.stringify(CHAMP_PROFILE_OVERRIDES, null, 2);
    document.getElementById('editor-msg').innerText = "í˜„ì¬ ì˜¤ë²„ë¼ì´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.";
}

function applyProfileEditor() {
    const msg = document.getElementById('editor-msg');
    const raw = document.getElementById('profile-editor').value.trim();
    if (!raw) {
        msg.innerText = "ì…ë ¥ëœ JSONì´ ì—†ìŠµë‹ˆë‹¤.";
        return;
    }
    try {
        const next = JSON.parse(raw);
        Object.keys(CHAMP_PROFILE_OVERRIDES).forEach((k) => delete CHAMP_PROFILE_OVERRIDES[k]);
        Object.keys(next).forEach((k) => {
            const row = next[k];
            if (!row || !row.type || !row.scale) return;
            const parsedType = normalizeTypeKey(row.type);
            if (!parsedType) return;
            CHAMP_PROFILE_OVERRIDES[k] = {
                type: parsedType,
                scale: clampScale(row.scale),
                pos: row.pos || undefined
            };
        });
        Object.keys(CHAMP_DB).forEach((key) => {
            const champ = CHAMP_DB[key];
            if (CHAMP_PROFILE_OVERRIDES[key]) {
                champ.profile.type = CHAMP_PROFILE_OVERRIDES[key].type;
                champ.profile.scale = CHAMP_PROFILE_OVERRIDES[key].scale;
                if (CHAMP_PROFILE_OVERRIDES[key].pos) champ.pos = [CHAMP_PROFILE_OVERRIDES[key].pos];
            }
        });
        renderPool();
        calculateStats();
        msg.innerText = "ì ìš© ì™„ë£Œ: ëŸ°íƒ€ì„ì— ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. (ì§€ì† ì €ì¥ì€ ì½”ë“œì— ë¶™ì—¬ë„£ê¸°)";
    } catch (err) {
        msg.innerText = `JSON íŒŒì‹± ì˜¤ë¥˜: ${err.message}`;
    }
}

init();
</script>
</body>
</html>
